//This is for the benefit of jStorage
jQuery.extend({toJSON:JSON.stringify,evalJSON:JSON.parse}),jQuery(function(a){function d(){if(c)return;var d={};a(".display-option input, .display-option textarea").each(function(a,b){d[b.id]=b.type==="checkbox"?b.checked:b.value}),b=encodeURIComponent(JSON.stringify(d)),window.location.hash=b}function e(){var b=null;try{b=JSON.parse(decodeURIComponent(window.location.hash.replace(/^#/,"")))}catch(c){return}a(".display-option input, .display-option textarea").each(function(c,d){if(d.id in b){var e=null;d.type==="checkbox"?(e=d.checked,d.checked=b[d.id]):(e=d.value,d.value=b[d.id]),e!==b[d.id]&&a(d).trigger("change")}})}window.Etsy=window.Etsy||{},window.Etsy.Page=window.Etsy.Page||{};var b=window.location.hash;(function(){"onhashchange"in window||setInterval(function(){window.location.hash!==b&&(b=window.location.hash,a(window).trigger("hashchange"))},100)})();var c=!0;a(window).bind("hashchange",function(){b!==window.location.hash&&e()}),e(),a(window).bind("blur",function(){Etsy.Supergrep.setBackground(!0)}),a(window).bind("focus",function(){Etsy.Supergrep.setBackground(!1)}).trigger("focus"),a("#clear-log").bind("click",function(){return Etsy.Supergrep.clearEntries(),!1}),a("#legend-help").bind("click",function(){return a("#legend-dialog").dialog({autoOpen:!0,width:600,buttons:{Ok:function(){a(this).dialog("close")}}}),!1}),a("#guide-help").bind("click",function(){return guiders.hideAll(),guiders.show("guide_welcome"),!1}),a(".rule-help").bind("click",function(){return a("#rule-help-dialog").dialog({autoOpen:!0,width:600,buttons:{Ok:function(){a(this).dialog("close")}}}),!1}),a("#wrap-lines").bind("change",function(){d(),a("#results").toggleClass("wrapping",this.checked)}).trigger("change"),a("#sort-order").bind("change",function(){d(),Etsy.Supergrep.setSortOrder(this.checked?Etsy.Supergrep.SortOrder.Ascending:Etsy.Supergrep.SortOrder.Descending)}).trigger("change"),a("#autoscroll").bind("change",function(){d(),Etsy.Supergrep.setAutoscroll(this.checked)}).trigger("change"),a("#max-entries").bind("change",function(){var a=parseInt(this.value,10);if(isNaN(a)){this.value=Etsy.Supergrep.getMaxEntries();return}this.value=a,d(),Etsy.Supergrep.setMaxEntries(a)}).trigger("change"),a("#clear-field-filter").bind("click",function(){return a("#filter-log").val("").trigger("change"),!1}),a("#filter-log").bind("change",function(){var b=!1;try{b=!!Etsy.Supergrep.parseFilterRule(this.value)}catch(c){}if(a.trim(this.value)!==""&&!b){a("#filter-log").addClass("error");return}a("#filter-log").removeClass("error"),d(),Etsy.Supergrep.setFilter(this.value)}).trigger("change"),a("#filter-invert-option").bind("change",function(){Etsy.Supergrep.setFilterInvert(!!a("#filter-invert-option:checked").length)}).trigger("change"),a("#clear-field-highlight").bind("click",function(){return a("#highlight-log").val("").trigger("change"),!1}),a("#highlight-log").bind("change",function(){var b=!1;try{b=!!Etsy.Supergrep.parseFilterRule(this.value)}catch(c){}if(a.trim(this.value)!==""&&!b){a("#highlight-log").addClass("error");return}a("#highlight-log").removeClass("error"),d(),Etsy.Supergrep.setHighlight(this.value)}).trigger("change"),a(".log-option").bind("change",function(){var b=[],c=[];a(".log-option").each(function(){var d=a(this).attr("data-log");a(this).is(":checked")?b.push(d):c.push(d)}),d(),Etsy.Supergrep.watchLogs(b,c)}),a("#log-web").trigger("change"),c=!1,window.Etsy.Page.showBlame=function(c,d,e){var f=a(c).parents("li:first"),g=a('<span class="blameInfo">Loading...</span>');a(c).remove(),f.append(g),a.ajax("/blame/web/"+d+"@"+e+","+e,{dataType:"jsonp",success:function(a,b,c){!a.error,g.text(a.error?"[Blamebot error: "+(a.error.details||a.error.msg)+"]":"["+(new Date(a["author-time"]*1e3)).format("m/d HH:MM:ss")+"] "+a.author+" - "+a.summary)}})}});